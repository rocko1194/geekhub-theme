if(!String.prototype.format){String.prototype.format=function(){var A=arguments;return this.replace(/{(\d+)}/g,function(B,C){return typeof A[C]!="undefined"?A[C]:B})}}window.TVproductions=window.TVproductions||{};(function(A,J,K){var O=null;var R=function(T,S){return J(".easy-photo-album-table tr["+T+'="'+S+'"]')};var N=function(){var S=[];J(".easy-photo-album-table tr td.column-image").each(function(U,W){$row=Q(W);var T=parseInt($row.attr("data-epa-id"),10);var V={id:T,order:parseInt($row.attr("data-epa-order"),10),title:L(T),caption:B(T)};S.push(V)});J("#epa-albumdata").val(JSON.stringify(S))};var I=function(){P();D()};var P=function(){if(A.maxOrder<1){J(".easy-photo-album-table .row-actions .order_up, .easy-photo-album-table .row-actions .order_down").hide()}else{J(".easy-photo-album-table tr td.column-image").each(function(T,U){$row=Q(U);order=parseInt($row.attr("data-epa-order"),10);if(order<=0){J(".row-actions .order_up",$row).hide();J(".row-actions .order_down",$row).show()}else{if(order>=A.maxOrder){J(".row-actions .order_down",$row).hide();J(".row-actions .order_up",$row).show();J(".row-actions .order_up",$row).html(J(".row-actions .order_up",$row).html().replace(" | ",""))}else{J(".row-actions .order_down, .row-actions .order_up",$row).show();if(J(".row-actions .order_up",$row).html().indexOf("|")===-1){J(".row-actions .order_up",$row).append(" | ")}}}})}var S;if(A.maxOrder==0){S=A.lang.photo}else{S=A.lang.photos}J("#easy-photo-album-images .displaying-num").html((A.maxOrder+1)+" "+S)};var G=function(T){var S=R("data-epa-id",T);if(S===K){return -1}else{return parseInt(S.attr("data-epa-order"),10)}};var M=function(S){var T=R("data-epa-order",S);if(T===K){return -1}else{return parseInt(T.attr("data-epa-id"),10)}};var C=function(T){var S=R("data-epa-id",T);return Q('input[type=checkbox][value="'+T+'"]')};var Q=function(S){return J(S).closest("tr")};var H=function(Y,V,U){var T=M(U);var Z=R("data-epa-id",T);var W=R("data-epa-id",V);if(J.isEmptyObject(Z)||J.isEmptyObject(W)){return }var S=Z.html();var X=W.html();if(S==K||X==K){console.error("Easy Photo Album: HTML Undefined Error");return }Z.html(E(X,Y,U));W.html(E(S,U,Y))};var E=function(T,U,S){return T.replace('data-epa-order="'+U+'"','data-epa-order="'+S+'"')};var F=function(U,S){var T=R("data-epa-id",U);if(T===K){return }else{T.attr("data-epa-order",S)}};var D=function(){J(".order_up a.epa-move-up, .order_down a.epa-move-down, .delete a").unbind("click");setTimeout(function(){J(".order_up a.epa-move-up").click(function(S){if(S.target.tagName.toLowerCase()=="a"){A.moveUp(this)}S.preventDefault()});J(".order_down a.epa-move-down").click(function(S){if(S.target.tagName.toLowerCase()=="a"){A.moveDown(this)}S.preventDefault()});J(".delete a").click(function(S){if(S.target.tagName.toLowerCase()=="a"){A.deletePhoto(this)}S.preventDefault()});J('input[name="'+A.settingName+'[add_photo]"]').click(function(S){A.addPhoto(this);S.preventDefault()});J("easy-photo-album-table tbody tr").not(".alternate").css({"background-color":"#F9F9F9"})},50)};var L=function(S){return J("input#"+A.settingName+"-title-"+S).val()};var B=function(S){return J("textarea#"+A.settingName+"-caption-"+S).val()};A.moveUp=function(U){var V=parseInt(Q(U).attr("data-epa-id"),10);var S=G(V);if(S<=0){return }var T=S-1;H(S,V,T);I()};A.moveDown=function(U){var V=parseInt(Q(U).attr("data-epa-id"),10);var S=G(V);if(S>=A.maxOrder){return }var T=S+1;H(S,V,T);I()};A.addPhoto=function(S){if(!O){if(!wp.media){console.error("Easy Photo Album: Wordpress media files not included or loaded correctly. Uploads disabled.");return }O=wp.media({title:A.lang.mediatitle,button:{text:A.lang.mediabutton},library:{type:"image",},multiple:true,frame:"select",});O.on("select",function(){var T=O.state().get("selection");T.map(function(V){var X=V.toJSON();var U=A.maxOrder+=1;var W=_.template(A.rowtemplate,{alternate:(U%2===0?' class="alternate"':""),id:X.id,imgurl:(X.sizes.thumbnail==K?X.sizes.full.url:X.sizes.thumbnail.url),order:U,title:X.title,caption:X.caption});J(".easy-photo-album-table tr:last").after(W)});I()},this)}wp.media.model.settings.post.id=J("#post_ID").val();O.open()};A.deletePhoto=function(V){var X=parseInt(Q(V).attr("data-epa-id"),10);if(X&&confirm(A.lang.deleteconfirm.format(L(X)))){var W=G(X);var T=Q(V);T.remove();A.maxOrder-=1;for(var U=W;U<=A.maxOrder;U++){var S=M(U+1);F(S,U)}I()}};(function(){if(J(".easy-photo-album-table").length>0){if(A.settingName==K){console.info("EasyPhotoAlbum: settingName not set, use default");A.settingName="EasyPhotoAlbums"}if(A.maxOrder==K){console.info("EasyPhotoAlbum: maxOrder not set, calculate value");A.maxOrder=J("#the-list tr").length}I();J(".easy-photo-album-table tbody").sortable({axis:"y",handle:".column-image img",placeholder:"sortable-placeholder",forcePlaceholderSize:true,cursor:"move",opacity:0.6,update:function(T,U){jQuery(".easy-photo-album-table tbody tr").each(function(V,W){F(parseInt(Q(W).attr("data-epa-id"),10),V)});J(".easy-photo-album-table tr:nth-child(odd)").addClass("alternate");J(".easy-photo-album-table tr:nth-child(even)").removeClass("alternate");I()}});J("#publish, #doaction, #doaction2, #post-preview, #save-post").click(N);var S=null;J(".epa-help").click(function(T){J(".epa-help-content").fadeOut("fast");if(S!=J(this).data("helpid")){J("#"+J(this).data("helpid")).fadeIn("fast").css("display","inline-block");S=J(this).data("helpid")}else{S=null}});J(document).click(function(T){if(S!=J(T.target).data("helpid")){J(".epa-help-content").fadeOut("fast");S=null}})}})()})(window.TVproductions.EasyPhotoAlbum=window.TVproductions.EasyPhotoAlbum||{},jQuery);